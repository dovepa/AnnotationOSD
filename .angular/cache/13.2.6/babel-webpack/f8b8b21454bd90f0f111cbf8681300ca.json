{"ast":null,"code":"\"use strict\";\n\nclass QueueItem {\n  constructor(onLoad, onError, dependentItem) {\n    this.onLoad = onLoad;\n    this.onError = onError;\n    this.data = null;\n    this.error = null;\n    this.dependentItem = dependentItem;\n  }\n}\n\n/**\n * AsyncResourceQueue is the queue in charge of run the async scripts\n * and notify when they finish.\n */\nmodule.exports = class AsyncResourceQueue {\n  constructor() {\n    this.items = new Set();\n    this.dependentItems = new Set();\n  }\n  count() {\n    return this.items.size + this.dependentItems.size;\n  }\n  _notify() {\n    if (this._listener) {\n      this._listener();\n    }\n  }\n  _check(item) {\n    let promise;\n    if (item.onError && item.error) {\n      promise = item.onError(item.error);\n    } else if (item.onLoad && item.data) {\n      promise = item.onLoad(item.data);\n    }\n    promise.then(() => {\n      this.items.delete(item);\n      this.dependentItems.delete(item);\n      if (this.count() === 0) {\n        this._notify();\n      }\n    });\n  }\n  setListener(listener) {\n    this._listener = listener;\n  }\n  push(request, onLoad, onError, dependentItem) {\n    const q = this;\n    const item = new QueueItem(onLoad, onError, dependentItem);\n    q.items.add(item);\n    return request.then(data => {\n      item.data = data;\n      if (dependentItem && !dependentItem.finished) {\n        q.dependentItems.add(item);\n        return q.items.delete(item);\n      }\n      if (onLoad) {\n        return q._check(item);\n      }\n      q.items.delete(item);\n      if (q.count() === 0) {\n        q._notify();\n      }\n      return null;\n    }).catch(err => {\n      item.error = err;\n      if (dependentItem && !dependentItem.finished) {\n        q.dependentItems.add(item);\n        return q.items.delete(item);\n      }\n      if (onError) {\n        return q._check(item);\n      }\n      q.items.delete(item);\n      if (q.count() === 0) {\n        q._notify();\n      }\n      return null;\n    });\n  }\n  notifyItem(syncItem) {\n    for (const item of this.dependentItems) {\n      if (item.dependentItem === syncItem) {\n        this._check(item);\n      }\n    }\n  }\n};","map":{"version":3,"names":["QueueItem","constructor","onLoad","onError","dependentItem","data","error","module","exports","AsyncResourceQueue","items","Set","dependentItems","count","size","_notify","_listener","_check","item","promise","then","delete","setListener","listener","push","request","q","add","finished","catch","err","notifyItem","syncItem"],"sources":["/home/dove/Documents/tchek/AnnotationOSD/node_modules/jsdom/lib/jsdom/browser/resources/async-resource-queue.js"],"sourcesContent":["\"use strict\";\n\nclass QueueItem {\n  constructor(onLoad, onError, dependentItem) {\n    this.onLoad = onLoad;\n    this.onError = onError;\n    this.data = null;\n    this.error = null;\n    this.dependentItem = dependentItem;\n  }\n}\n\n/**\n * AsyncResourceQueue is the queue in charge of run the async scripts\n * and notify when they finish.\n */\nmodule.exports = class AsyncResourceQueue {\n  constructor() {\n    this.items = new Set();\n    this.dependentItems = new Set();\n  }\n\n  count() {\n    return this.items.size + this.dependentItems.size;\n  }\n\n  _notify() {\n    if (this._listener) {\n      this._listener();\n    }\n  }\n\n  _check(item) {\n    let promise;\n\n    if (item.onError && item.error) {\n      promise = item.onError(item.error);\n    } else if (item.onLoad && item.data) {\n      promise = item.onLoad(item.data);\n    }\n\n    promise\n      .then(() => {\n        this.items.delete(item);\n        this.dependentItems.delete(item);\n\n        if (this.count() === 0) {\n          this._notify();\n        }\n      });\n  }\n\n  setListener(listener) {\n    this._listener = listener;\n  }\n\n  push(request, onLoad, onError, dependentItem) {\n    const q = this;\n\n    const item = new QueueItem(onLoad, onError, dependentItem);\n\n    q.items.add(item);\n\n    return request\n      .then(data => {\n        item.data = data;\n\n        if (dependentItem && !dependentItem.finished) {\n          q.dependentItems.add(item);\n          return q.items.delete(item);\n        }\n\n        if (onLoad) {\n          return q._check(item);\n        }\n\n        q.items.delete(item);\n\n        if (q.count() === 0) {\n          q._notify();\n        }\n\n        return null;\n      })\n      .catch(err => {\n        item.error = err;\n\n        if (dependentItem && !dependentItem.finished) {\n          q.dependentItems.add(item);\n          return q.items.delete(item);\n        }\n\n        if (onError) {\n          return q._check(item);\n        }\n\n        q.items.delete(item);\n\n        if (q.count() === 0) {\n          q._notify();\n        }\n\n        return null;\n      });\n  }\n\n  notifyItem(syncItem) {\n    for (const item of this.dependentItems) {\n      if (item.dependentItem === syncItem) {\n        this._check(item);\n      }\n    }\n  }\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}